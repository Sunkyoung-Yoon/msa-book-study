# 7.2 클라이언트 회복성이 중요한 이유
작성자: 윤선셩
</br>
</br>
</br>

### 문제 발생 상황
p251 그림7-2 참고

위 그림 형태에서는 NAS에서의 약간의 수정으로 인한 일부 디스크 하위 시스템에 읽기 작업이 느려지면 </br>
-> 재고 서비스가 느려지고 이는 결국 재고 서비스로 느려진 조직 서비스를 라이선싱 서비스가 호출하는 형태가 된다.</br>
-> 재고 서비스에 대한 호출이 완료되지 않아 커넥션이 사용중이기 때문에 서비스 컨테이너의 커넥션 풀에 있는 데이터베이스 커넥션 수도 고갈된다.

**그래서 회로 차단기를 구현해주어야 한다. (애플리케이션과 원격 서비스 사이에서 중재자 역할을 하는 것)**

</br>

### 회로차단기 구현 예시
p252 그림 7-3 참고(3가지 시나리오)

1. 정상 시나리오
    * 회로 차단기는 타이머를 설정하고 타이머가 만료되기 전에 원격 호출이 완료되면 라이선싱 서비스는 정상적으로 모든 작업을 수행할 수 있다.
2. 부분적인 서비스 저하 시나리오 (폴백 없는 회로 차단기)
    * 라이선싱 서비스는 회로 차단기를 통해 조직 서비스를 호출할 때, 타이머가 만료되었는데도 호출이 완료되지 않는다면 이때 회로 차단기는 원격 서비스에 대한 연결을 종료하고 라이선싱 서비스는 호출오류를 반환한다.
    * 라이선싱 서비스가 조직 호출이 완료되길 기다리면서 자원 점유를 하지 않는다.
    * 타이머 만료시 발생한 실패 횟수를 추적해서 특정 시간 동안 많은 오류가 발생하면 회로 차단기는 회로를 차단한다.(조직서비스에 대한 모든 호출은 조직 서비스 호출 없이 바로 실패)
3. 폴백 있는 회로 차단기
    * 라이선싱 서비스는 회로 차단기의 타이머 만료를 기다리지 않고 문제를 바로 알 수 있어 완전히 실패하거나 대체 코드(폴백)을 사용하는 조치하는 방법을 취할 수 있다.
    * 회로 차단기가 차단되면 라이선싱 서비스는 조직 서비스 호출 x -> 조직 서비스는 회복할 수 있는 기회 확보

</br>

### 원격 호출에 대한 회로 차단기 패턴
|이점|의미|
|:--|:--|
|빠른 실패|원격 서비스가 성능 저하를 겪으면 애플리케이션은 빠르게 실패하고 전체 애플리케이션을 완전히 다운 시킬 수 있는 자원 고갈 이슈를 방지한다.|
|원만한 실패|타임 아웃과 빠른 실패를 사용하는 회로 차단기 패턴은 원만하게 실패하거나 사용자 의도를 충족하는 대체 매커니즘을 제공할 수 있게 해준다.</br>* 사용자가 데이터 검색을 하려는 곳에서 서비스 저하를 겪고 있다면 다른 곳에서 검색할 수 있도록 한다.|
|원활한 회복|회로 차단기 패턴이 중개자 역할을 하므로 회로 차단기는 요청 중인 자원이 다시 온라인 상태가 되었는지 확인하고, 사람의 개입없이 자원에 대한 재접근을 허용하도록 주기적으로 확인한다.|

</br>
⭐ 수 백개의 서비스를 사진 대규모 클라우드 기반 애플리케이션에서 이렇게 원활하게 회복하는 것은 서비스를 복구하는 데 필요한 시간을 크게 줄일 수 있어 중요하다!


Resilience4j 이전에는 마이크로서비스에서 회복성 패턴을 구현할 수 있는 가장 일반적인 자바 라이브러리 중 하나로 히스트릭스가 사용했다. 이제 히스트릭스는 유지 보수 단계로 전환되어 더 이상 새로운 기능이 추가되지 않는다.</br>
히스트릭스의 대체 라이브러리로 권장되는 것 중 하나가 Resilience4j이다.


