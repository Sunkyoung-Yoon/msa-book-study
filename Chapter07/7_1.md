# 7.1 클라이언트 측 회복성이란?

담당자: 박희선
</br>
</br>
</br>

클라이언트 측 회복성 소프트웨어 패턴들은 에러나 성능 저하로 원격 자원이 실패할 때 원격 자원의 클라이언트가 고장 나지 않게 보호하는 데 중점을 둠 </br>

- 클라이언트가 빨리 실패하고 데이터베이스 커넥션과 스레드 풀 같은 소중한 자원을 소비하는 것을 방지할 수 있음
- 제대로 성능이 낮은 원격 서비스 문제가 소비자에게 upstream 으로 확산되는 것을 막음

## 네 가지 클라이언트 회복성 패턴

### 7.1.1 클라이언트 측 로드 밸런싱

- 클라이언트 측 로드밸런싱은 클라이언트가 서비스 디스커버리 에이전트에서 서비스의 모든 인스턴스를 검색한 후 해당 서비스 인스턴스의 물리적 위치를 캐싱하는 작업 포함함 </br>
- 서비스 소비자가 서비스 인스턴스를 호출해야 할 때 클라이언트 측 로드 밸런싱은 관리 중인 서비스 위치 풀에서 위치를 반환함 </br>
- 클라이언트 측 로드 밸런서는 서비스 클라이언트와 서비스 소비자 사이에 위치하기 때문에 서비스 인스턴스가 에러를 발생하거나 정상적으로 당작하지 않는지 탐지 가능 </br>
  - 클라이언트 측 로드 밸런서가 문제 탐지시 가용 서비스 풀에서 문제된 서비스 인스턴스를 제거하여 해당 서비스 인스턴스로 더 이상 호출되지 않게 함

### 7.1.2 회로 차단기

> 회로 차단기 패턴은 전기 회로의 차단기 모델링 한 것

전기 시스템에서 회로 차단기는 전선을 통해 과전류가 흐르는지 탐지함 </br>
회로 차단기가 문제를 탐지하면 나머지 전기 시스템의 연결을 끊고 하부 구성 요소가 타지 않게 보호함 </br>
👉 소프트웨어 회로 차단기는 **_원격 서비스가 호출될 때 호출을 모니터링_** 함 </br>
호출이 너무 오래 걸리면 차단기가 개입해서 호출을 종료 </br>
회로 차단기 패턴은 원격 자원에 대한 모든 호출을 모니터링하고, 호출이 충분히 실패하면 회로 차단기 구현체가 열리면서 빠르게 실패하고 고장 난 원격 자원에 대한 추가 호출을 방지함

### 7.1.3 폴백 처리

> 폴백 패턴을 사용하면 원격 서비스 호출이 실패할 때 예외를 생성하지 않고 서비스 소비자가 **_대체 코드 경로_**를 실행하여 다른 수단을 통해 작업을 수행할 수 있다

- 보통 다른 데이터 소스에서 데이터를 찾거나
- 향후 처리를 위해 사용자 요청을 큐에 입력하는 작업

사용자 호출에 문제가 있다고 예외를 표시하지는 않지만 나중에 요청을 시도해야 한다고 알려줄 수 있음 </br>
🗯 예시 | 사용자 기호에 맞춰 추천해주는 기능이 망가졌을 때 일반화된 기호 목록 보여줌

### 7.1.4 벌크헤드

벌크헤드는 선박을 건조하는 개념에서 유래됨 </br>
선체에 구멍이 뚫려도 침수 구역을 구멍이 난 격벽으로만 제한하므로 배 전체에 물이 차서 침몰되는 것을 방지함 </br>

> 벌크헤드 패턴 사용시 원격 자원에 대한 호출을 자원별 스레드 풀로 분리하면, 느린 원격 자원 호출 하나로 발생한 문제가 전체 애플리케이션을 다운시킬 위험을 줄임

스레드 풀은 서비스의 벌크헤드 역할을 함 </br>

- 각 원격 자원을 분리하여 스레드 풀에 각각 할당함
- 한 서비스가 느리게 응답한다면 해당 서비스의 호출 그룹에 대한 스레드 풀만 포화되어 요청 처리를 중단하게 할 수 있다
- 스레드 풀별로 서비스를 할당하면 다른 서비스는 포화되지 않기 때문에 이러한 병목 현상을 우회하는 데 유용함
