# 4.4 도커 컴포즈

담당자: 박희선
</br>
</br>
</br>

서비스 설계와 구축이 용이한 스크립트를 작성하여 도커를 더 쉽게 사용하게 함 </br>
도커 컴포즈를 사용하면 여러 컨테이너를 하나의 서비스로 실행하거나 다른 컨테이너 동시 생성 가능 </br>

## 도커 컴포즈 사용 순서

1. 도커 컴포즈 설치 Install Docker Compose
2. YAML 파일을 생성하여 애플리케이션 서비스 구성
   - 이 파일 이름을 docker-compose.yml 로 지정해야 함
3. docker-compose config 명령을 사용하여 파일 유효성 확인
4. docker-compose up 명령을 사용하여 서비스 시작

## 도커 컴포즈 지시어

| 지시어      | 설명                                                                                                                                                                                                                                                                                            |
| :---------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| version     | 도커 컴포드 도구의 버전 지정                                                                                                                                                                                                                                                                    |
| service     | 배포할 서비스 지정 </br> 서비스 이름은 도커 인스턴스에 대한 DNS 엔트리이며, 다른 서비스에서 액세스 하는 데 사용됨                                                                                                                                                                               |
| image       | 특정 이미지를 사용하여 컨테이너를 실행하도록 지정                                                                                                                                                                                                                                               |
| port        | 시작한 도커 컨테이너가 외부에 노출할 포트 번호 지정 </br> 내부 및 외부 포트 매핑                                                                                                                                                                                                                |
| environment | 시작하는 도커 이미지에 환경 변수 전달                                                                                                                                                                                                                                                           |
| network     | 복잡한 토폴로지를 만들 수 있도록 커스텀 네트워크 지정 </br> 타입(host, overlay, macvlan, none)을 지정하지 않았다면 디폴트 타입은 **_bridge_** </br> bridge 네트워크 사용하면 동일한 네트워크 내 컨테이너 연결 관리 가능, 이 네트워크는 동일한 도커 데몬 호스트에서 실행되는 컨테이너에만 적용됨 |
| alias       | 네트워크 내 서비스에 대한 호스트 별명 지정                                                                                                                                                                                                                                                      |

## 도커 컴포즈 명령어

| 명령어                           | 설명                                                                                                                                                                              |
| :------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| docker-compose up -d             | 애플리케이션 이미지 빌드하고 정의된 서비스 시작 </br> 이 명령은 필요한 모든 이미지 내려받아 배포하고 컨테이너 시작 </br> -d 매개변수는 백그라운드 모드에서 도커를 실행하도록 지정 |
| docker-compose logs              | 최신 배포에 대한 모든 정보 확인                                                                                                                                                   |
| docker-compose logs <service_id> | 특정 서비스에 대한 로그 확인                                                                                                                                                      |
| docker-compose ps                | 시스템에 배포한 모든 컨테이너 목록 출력                                                                                                                                           |
| docker-compose stop              | 서비스를 마치고 나서 서비스 중지 👉 컨테이너도 중지됨                                                                                                                             |
| docker-compose down              | 모든 것을 종료하고 컨테이너도 모두 제거됨                                                                                                                                         |
